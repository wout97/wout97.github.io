<!DOCTYPE html>
<html>
<head>
    
    <title>Spotify Recomender app</title>
</html> <!-- Import the Ionic CSS -->
<link href="https://unpkg.com/@ionic/core@latest/css/ionic.bundle.css" rel="stylesheet">
<!-- Import Ionic -->
<script src="https://unpkg.com/@ionic/core@latest/dist/ionic.js"></script>
<!-- Import the Ionic icons -->
<script src="https://unpkg.com/ionicons@latest/dist/ionicons.js"></script>
<!-- Import the fontawesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<!-- Import custom css -->
<link rel="stylesheet" href="style.css">
<!-- Import custom js -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>



</head>
<body>

    <!-- We declare an Ionic app using the <ion-app/> element -->
    <ion-app fullscreen>
        <ion-content overflow-scroll="true">
            <!-- Cool thing, the Ionic CSS utilities could be used too -->
            <div class="container">
                <img class="custom_center" src="https://lh3.googleusercontent.com/zrHXaAED3EH2LMPfr27jaJTzNLVDFZ_VCbVDh4ETPol6xwDp6io6W-iK7Iup96sNPJBbACbyLcaMqsM42qDsvtYd3sz03-40HO4qTRTEx7BcvUCRcK7RyxBOvl4somx8AUuEW1-OgZxIu8wQEEJh-45-LP8LA3yDurkLSKZpslTfleZwoZtQT8WFrqTTm8jPjyfN3BwO_prSgnDvPZ0mht_O7_af-6jL9IJ6J6osGns0UQrvHIuUOYrHPVphIbw7TQiT86YSC5afMEChjY73nBHwLoWRcusRlZ_TgB24zZ3flns1woHbQLuECnPobcLA1qhCI9VXHs-Y6s17a0uuYI-wdE3EDmoHjBnqxgG0FQ-OV4fiGDqxfR8dIFW7l_SScbmR_5xg4TL2V20YJH40VgoTqeycgREq-pgjc7qeOsyBnka9cCNLyfAhKTET1b-QpWtt0YiQ3CFFJLuFzlgmUQ3_RTzu933ZCcvUG1ZTkuA0mLGMzs380_JL-Zo5weziHUTDBhaQ_NMFKDiVIjk1CCLTbk91lIB1mKwdV5jWGOohrGy1NprFxUKvWaM9MghHloplHFbco-qAlGwRt1NGTtlsQN2lkmEN2CJk9IUwLnUoaJAfWFGifz2eRqutIzGBd2pCbNxftG5yF4qNG5Zl61ZfpQReqd1KngZFhX1qCzNdmnQ-qkCIHXn2ymzNeYyDEfkZ4DLQaYw8I_E9RCmDKB6IlTrkeFH9QHTIxq-A95sZH-QylQ=s500-no" alt="logo spotify recomender" class="custom_center">
                <!-- Horizontal Stepper-->

                <div class="md-stepper-horizontal orange">
                    <div class="md-step active">
                        <div class="md-step-circle"><span>1</span></div>
                        <div class="md-step-title"></div>
                        <div class="md-step-optional"><a href=" index.html">Pick</a></div>
                        <div class="md-step-bar-left"></div>
                        <div class="md-step-bar-right"></div>
                    </div>

                    <div class="md-step  ">
                        <div class="md-step-circle"><span>2</span></div>
                        <div class="md-step-title"></div>
                        <div class="md-step-optional"><a href=" tune.html">Tune</a></div>
                        <div class="md-step-bar-left"></div>
                        <div class="md-step-bar-right"></div>
                    </div>

                    <div class="md-step ">
                        <div class="md-step-circle"><span>3</span></div>
                        <div class="md-step-title"></div>
                        <div class="md-step-optional">Final</div>
                        <div class="md-step-bar-left"></div>
                        <div class="md-step-bar-right"></div>
                    </div>
                </div>

                <ion-text text-center>
                    <h2>Pick the playlist you like</h2>
                </ion-text>

                <!-- Searchbar with cancel button always shown -->
                <ion-searchbar show-cancel-button="always" inputmode="md"></ion-searchbar>

                <small style="padding:10px;"> suggested playlists</small>
                <div class="playlists" id="playlists"><p>generating</p></div>


                <!--<script src="script.js"></script>-->
                Just a test to see if github updates...
                <small>
                    <!-- Copyright -->
                    <div class="text-center">
                        © 2019 Copyright:
                        <a href=""> HCI group 5</a>
                    </div>
                </small>
                <!-- Copyright -->

            </div>

       
        </ion-content>


</ion-app>
    <script>

        //Authorization links
        var oAuthUrl="https://accounts.spotify.com/authorize?client_id=059f69ae51c445518b106f91e9ddaf9c&redirect_uri=https://wout97.github.io/&scope=user-read-private%20user-read-email&response_type=token&state=123"
        var dash="https://developer.spotify.com/dashboard/applications/059f69ae51c445518b106f91e9ddaf9c"
        var newToken="https://developer.spotify.com/console/get-playlists/?user_id=wizzler&limit=&offset="
        var url_string = window.location.href;
        var access_token = url_string.match(/\#(?:access_token)\=([\S\s]*?)\&/)[1];
        console.log("test");
        var client_id = getClientId();

        console.log(client_id);

        function getClientId(){
        var response = callSpotifyAPI2("https://api.spotify.com/v1/me");
        console.log(response);
        return null;

        }


        //get playlists and generate html
        var playlists = getPlaylists();
        displayPlaylists(playlists);


        //Get array of user playlists
        function getPlaylists() {
        var response = callSpotifyAPI("null");
        trackList = getTracksfromResponse(response);
        console.log(trackList);
        return getArrayUserPlaylist(response);
        }

        function getTracksfromResponse(response){
        var playlistUrl = response.items[0].href;
        var tracksresponse = callSpotifyAPI2(playlistUrl);
        var trackList=[];
        for (x in tracksresponse.tracks.items){
        console.log(tracksresponse.tracks.items[x].track.name);
        trackList.push(tracksresponse.tracks.items[x].track.name)
        }
        return trackList;
        }

        //Uses own token to get my playlists from spotifyAPI returns JSON response
        function callSpotifyAPI(url){
        var user_id = "11135844104";
        var authToken =access_token;
        var token1 = "Bearer " + authToken;
        var playlistUrl = "https://api.spotify.com/v1/users/" + user_id + "/playlists";
        var response = httpGet(playlistUrl, token1);
        var playlist_response = JSON.parse(response);
        return playlist_response;
        }

        //Make trackPLaylist array from JSON response
        function getArrayUserPlaylist(response){
        var array = [];
        for (x in response.items) {
        console.log(response.items[x].name);
        array.push(response.items[x].name);
        }
        return array;
        }

        //Simple get request with auth
        function httpGet(theUrl, token) {
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.open("GET", theUrl, false); // false for synchronous request
        xmlHttp.setRequestHeader('Authorization', token);
        xmlHttp.send();
        return xmlHttp.responseText;
        }


        //generate html
        function displayPlaylists(playlists) {
        document.getElementById("playlists").innerHTML = "";
        var x;
        for (x in playlists) {

        document.getElementById("playlists").innerHTML += ' <button class="collapsible">' + playlists[x] + "   " + "<ion-icon name='musical-note'></ion-icon>" + '</button><div class="content" >' + getTracks(playlists[x]) + '</div>'
        }

        }

        //generate track html for playlist
        function getTracks(playlist) {
        var x;
        var trackItems = "";
        var tracks = ["song 1 :" + playlist, "song 2 :" + playlist, "song 3 :" + playlist, "song 4 : " + playlist, "song 5 :" + playlist, "song 6 :" + playlist];
        for (x in tracks) {

        trackItems += "<ion-item><ion-label>" + tracks[x] + " </ion-label>  <ion-checkbox slot='end' value='pepperoni' checked></ion-checkbox>  </ion-item>"
        }


        return " <ion-content fullscreen><ion-list>" + trackItems + "</ion-list><ion-button  " + "onclick='activated(" + '"' + playlist + '"' + ")'>Confirm</ion-button> </ion-content>"

        }

        //Uses own token to get my playlists from spotifyAPI returns JSON response
        function callSpotifyAPI2(url){
        var authToken1 =access_token;
        var token2 = "Bearer " + authToken1;
        var response = httpGet(url, token2);
        var playlist_response = JSON.parse(response);
        return playlist_response;
        }

        //generate collapsible divs
        var coll = document.getElementsByClassName("collapsible");
        var i;
        for (i = 0; i < coll.length; i++) {
        coll[i].addEventListener("click", function() {
        this.classList.toggle("active_collapsible");
        var content = this.nextElementSibling;
        if (content.style.maxHeight) {
        content.style.maxHeight = null;
        } else {
        content.style.maxHeight = "200" + "px";
        }
        });
        }

        function activated(playlist) {
        alert("You have selected the " + playlist + " playlist")
        }




    </script>

</body>

<style type="text/css">
    


</style>


